<!DOCTYPE html>
<html>
<head>
  <title>VillageCoin - Gatekeeper Console</title>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <script src="./common.js"></script>
</head>
<body>
  <h1>VillageCoin</h1>
  <br/>
  <h2>Pending Account Applications</h2>
  <table id="tableCreateAccountProposals"></table>
  
  <div id="status"></div>    
</body>
</html>
<script lang="javascript">

async function populateCreateAccountProposalsTable() 
{
    await app.populateProposalsTable(
        "tableCreateAccountProposals", 
        function(proposal) { return app.filterProposalByExistentUnvotedAndType(proposal, app.ProposalType.CreateAccount); }, 
        function(contract){ return contract.getCreateAccountProposal; }, 
        "<tr><td>#</td><td>Address of Proposed Account</td><td>Supporting Evidence</td><td>Vote</td></tr>",
        function(proposal){ return "<tr><td>" + proposal[0] + "</td><td>" + proposal[1] + "</td><td>"+ proposal[2] +"</td><td><button onclick='vote(" + proposal[0].toNumber() + ", true)'>YES</button><button onclick='vote(" + proposal[0].toNumber() + ", false)'>NO</button></td></tr>";});
}

async function vote(proposalId, isYes)
{
    try 
    {
        app.setStatus("Voting...");
        var villageCoin = app.contract;
        await villageCoin.voteOnProposal(proposalId, isYes, {from: app.account});
        app.setStatus("Your vote was recorded");
        await populateCreateAccountProposalsTable();
    } 
    catch(error)
    {
        console.log(error);
        app.setStatus(error);
    }

}

window.addEventListener('load', async function()
{
    await init();
    await app.initVillage();
    app.redirectNonManager();
    populateCreateAccountProposalsTable();
});
</script>
