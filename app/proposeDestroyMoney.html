<!DOCTYPE html>
<html>
<head>
  <title>VillageCoin - Make a Proposal</title>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <script src="./common.js"></script>
</head>
<body>
    <h1><span class="villageName"></span></h1>
    <h2>Propose Destroying Money</h2>
    <ul class="menu">
        <li class="menu"><a class="menu" href="index.html">Home</a></li>
        <li class="menu"><a class="menu" href="proposals.html">Vote</a></li>
        <li class="menu"><a class="menu" href="createProposal.html">Make a Proposal</a></li>
    </ul>  
    
    <p>Fight inflation and increase the value of <span class="villageSymbol"></span> by burning money from the public account</p>
    <p>If the proposal is enacted the specified amount of <span class="villageSymbol"></span> will be removed from the public account balance and destroyed</p>

    <p>Use the form below to propose money destruction</p>

    <p>I propose to destroy
        <input type="text" id="amount" class="inputAmount" placeholder="e.g., 5" onchange="validateForm()"></input><span class="villageSymbol"></span>
    </p>
    <p>You may optionally provide the URL of some <em>supporting evidence</em> to help convince other citizens of the value of your proposal.
        <input type="text" class="inputUrl" id="supportingEvidenceUrl" placeholder="e.g. https://i.imgur.com/J5MKGp2.gifv" onchange="validateForm()"></input>
    </p>
    
    <button class="voteButton" id="inputSubmit" onclick="submit()" disabled>Create Proposal</button></p>
    <div id="inputInvalidMessage"></div>
    <span id="status"></span>   
</body>
</html>
<script>

async function submit() 
{
    try
    {
        var results = await app.validateForm();
        if(!results.isValid) return;

        receipt = await app.contract.proposeDestroyMoney(results.amount, results.supportingEvidenceUrl, {from: app.account});

        var proposalId = receipt.logs[0].args.proposalId.toNumber();

        window.location.replace("proposal.html?id=" + proposalId);
    }
    catch(error)
    {
        console.log(error);
        app.setStatus(error);
    }

}

async function validateForm() 
{
    try
    {
        await app.validateForm();
    }
    catch(error)
    {
        console.log(error);
        app.setStatus(error);
    }
}

    window.addEventListener('load', async function()
    { 
        await init();      
        app.redirectNonCitizen();
    });
</script>
