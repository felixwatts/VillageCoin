<!DOCTYPE html>
<html>
<head>
  <title>VillageCoin - Open Proposals</title>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <script src="./common.js"></script>
</head>
<body>
    <h1><span class="villageName"></span></h1>
    <h2>Open Proposals</h2>  
    <ul class="menu">
        <li class="menu"><a class="menu" href="index.html">Home</a></li>
        <li class="menu"><a class="menu" href="proposals.html">Vote</a></li>
        <li class="menu"><a class="menu" href="createProposal.html">Make a Proposal</a></li>
    </ul>     
    <p>This is a list of proposals that are currently undecided. Although you never <em>have</em> to vote, it's important if you want to influence the future of the currency</p>    
    <table id="tableProposals"></table>

    <div id="status"></div>    
</body>
</html>
<script lang="javascript">

async function buildProposalRow(proposal)
{
    return "<tr><td><a href='proposal.html?id=" + proposal.id + "'>proposal #" + proposal.id + "</a></td><td>" + proposal.description + "</a>";
}

async function populateProposalsTable() 
{
    try 
    {
        var votableProposals = await app.getUndecidedProposals();
        var votableProposals = await Promise.all(votableProposals.map(buildProposalRow));

        var proposalsTableHtml = votableProposals.length == 0 
            ? "There are no outstanding proposals" 
            : votableProposals.reduce(function(accumulator, currentValue) { return accumulator + currentValue; }, "");

        document.getElementById("tableProposals").innerHTML = proposalsTableHtml;
    } 
    catch(error)
    {
        console.log(error);
        app.setStatus(error);
    }
}

window.addEventListener('load', async function()
{
    await init();
    app.redirectNonCitizen();
    await populateProposalsTable();
});
</script>
